{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0d3eacf7_711023aa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000185
      },
      "writtenOn": "2021-12-29T07:12:30Z",
      "side": 1,
      "message": "\u003e Patch Set 2:\n\u003e \n\u003e \u003e Patch Set 2:\n\u003e \u003e \n\u003e \u003e \u003e Patch Set 2:\n\u003e \u003e \u003e \n\u003e \u003e \u003e Hi Manash,\n\u003e \u003e \u003e Thanks your suggestion, I have provided the latest patch.\n\u003e \u003e \u003e Please help me to review it again. Thank you.\n\u003e \u003e \u003e \n\u003e \u003e \u003e Sincerely,\n\u003e \u003e \u003e Tim\n\u003e \u003e \n\u003e \u003e Lee, please provide me snippet of the output of this testcase execution.\n\u003e \n\u003e Hi Sarma,\n\u003e Here is the snippet about this test item. For you refer it. Thank you.\n\u003e \n\u003e TEST Verify Dump After Host Watchdog Error Injection\n\u003e Full Name:\tTest Bmc Dump.Verify Dump After Host Watchdog Error Injection\n\u003e Documentation:\t\n\u003e Inject host watchdog error and verify whether dump is generated.\n\u003e \n\u003e Tags:\tVerify_Dump_After_Host_Watchdog_Error_Injection\n\u003e Start / End / Elapsed:\t20211228 16:08:03.038 / 20211228 16:12:50.834 / 00:04:47.796\n\u003e Status:\tPASS\n\u003e SETUP connection_client . Open Connection And Log In\n\u003e KEYWORD boot_utils . Redfish Power On\n\u003e KEYWORD BuiltIn . Run Keyword And Ignore Error Redfish Delete All BMC Dumps\n\u003e KEYWORD dump_utils . Trigger Core Dump\n\u003e KEYWORD utils . Set Auto Reboot ${1}\n\u003e KEYWORD utils . Trigger Host Watchdog Error 2000, 30\n\u003e KEYWORD BuiltIn . Wait Until Keyword Succeeds 300 sec, 20 sec, Is Chassis PowerCycled\n\u003e KEYWORD @{dump_entry_list} \u003d rest_client . Read Properties ${DUMP_ENTRY_URI}\n\u003e KEYWORD ${length} \u003d BuiltIn . Get Length ${dump_entry_list}\n\u003e KEYWORD BuiltIn . Should Be Equal As Integers ${length}, ${1}\n\u003e KEYWORD ${value} \u003d Collections . Get From List ${dump_entry_list}, 0\n\u003e KEYWORD @{split_value} \u003d String . Split String ${value}, /\n\u003e KEYWORD ${dump_id} \u003d Collections . Get From List ${split_value}, -1\n\u003e KEYWORD ${dump_size} \u003d rest_client . Read Attribute ${DUMP_ENTRY_URI}${dump_id}, Size\n\u003e KEYWORD BuiltIn . Should Be True 0 \u003c ${dump_size} \u003c 204800\n\u003e TEARDOWN Test Teardown Execution\n\u003e \n\u003e ------------------------------------------------------------------------------\n\u003e Test Bmc Dump :: Test dump functionality of OpenBMC.                  | PASS |\n\u003e 1 test, 1 passed, 0 failed\n\u003e \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\u003e Output:  /home/cs20/single-Test-Automation/reports/156/redfish/extended/test_bmc_dump.robot/output.xml\n\u003e Log:     /home/cs20/single-Test-Automation/reports/156/redfish/extended/test_bmc_dump.robot/log.html\n\u003e Report:  /home/cs20/single-Test-Automation/reports/156/redfish/extended/test_bmc_dump.robot/report.html\n\n",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c288240_9d170981",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-04T09:01:19Z",
      "side": 1,
      "message": "Hi Rahul, Manash,\n\nAccording our investigation and test result. These two test items\n\"Verify Core Dump Size\" and \"Verify Dump After Host Watchdog Error Injection\"\nseems have dependence.\n\nI think that remove \"Run Keyword And Ignore Error  Redfish Delete All BMC Dumps\" this line\nmight be better change to fix this test item failed symptom.\n\nI found that another issue if I add \"Trigger Core Dump\" in \"Verify Dump After Host Watchdog Error Injection\"\nthis test item. That will cause \"2 !\u003d 1\" fail symptom.\n\nDue to test_bmc_dump.robot this test robot will execute these two test items sequentially.\n\"Trigger Core Dump\" be exectued in \"Verify Core Dump Size\", the first dump entry log will be created.\n\nHowever, if \"Trigger Core Dump\" be exectued again in \"Verify Dump After Host Watchdog Error Injection\"\nthat will cause the second dump entry log be created.\n\nBut, \"Verify Dump After Host Watchdog Error Injection\" test item will check there is only one dump entry.\nThus, we will got length \"2 !\u003d 1\" fail symptom when we run test_bmc_dump.robot.\n\n    # Verifying that there is only one dump\n    ${length}\u003d  Get length  ${dump_entry_list}\n    Should Be Equal As Integers  ${length}  ${1}\n\nIf there is any misunderstanding from my point of view.\nPlease share your suggestions to me. Thank you.\n\nSincerely,\nTim",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6df52f8_2152e22b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-01-04T11:37:06Z",
      "side": 1,
      "message": "Let me check the history of this test case and get back.",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65ff96f1_4d4e6d28",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-05T02:46:27Z",
      "side": 1,
      "message": "Thanks your help to review this test case.",
      "parentUuid": "e6df52f8_2152e22b",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dd3a3254_19678eb7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-05T02:46:27Z",
      "side": 1,
      "message": "Hi Rahul,\nThanks your help to review this test case.\nAnother thing need your help to confirm it.\n\nIn \"Test Teardown Execution\" that will execute \"Delete All BMC Dump\".\nHowever, when first test item finish the dump entry log will be deleted.\nThus, the second test item will got failed due to there is no more dump entry log.\n\nThus, the \"Delete All BMC Dump\" should be moved from \"Test Teardown Execution\"\nto \"Suite Teardown Execution\". \n\nSuite Teardown      Suite Teardown Execution\nSuite Teardown Execution\n    [Documentation]  Do the post-suite teardown.\n\n    Delete All BMC Dump",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c033856b_8751e002",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-01-05T10:18:54Z",
      "side": 1,
      "message": "Tim\nI tried to run \"Verify Dump After Host Watchdog Error Injection\" test case on our system without any of your changes and I don\u0027t see any problem. Test is passing.\n\nVerify Dump After Host Watchdog Error Injection :: Inject host wat... | PASS |\n------------------------------------------------------------------------------\nTest Bmc Dump :: Test dump functionality of OpenBMC.                  | PASS |\n1 critical test, 1 passed, 0 failed\n1 test total, 1 passed, 0 failed\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nSo please check why dump is not getting created on your system after injecting \nHost Watchdog Error. Better to run the steps manually and check if dump is getting created. If not, then better to check with Dev.\n\nAnother thing both Verify_Dump_After_Host_Watchdog_Error_Injection and Verify_Core_Dump_Size test cases are unrelated. So we should not mix them up. And each test case needs to independent of other test execution.\n\nThanks\n\n\n",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b4d18c8_2b1aea6e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-07T09:29:14Z",
      "side": 1,
      "message": "Thanks. Rahul. I will keep check different between our systems.",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "226286eb_61af3b91",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-07T09:29:14Z",
      "side": 1,
      "message": "Hello Rahul,\nThanks your great support to check this commit.\nI also try to run \"Verify Dump After Host Watchdog Error Injection\" test case on our system without my changes again. The test result is still fail.\n\nThere is no any dump log be created in below folders in BMC:\n/var/lib/phosphor-debug-collector/dumps or /var/lib/systemd/coredump\n\nI try to steps manually to run the test case, but no dump log be created.\nMy BMC environment console result as below:\nroot@olympus-nuvoton:/var/lib/phosphor-debug-collector/dumps# ls\nroot@olympus-nuvoton:/var/lib/phosphor-debug-collector/dumps#\nroot@olympus-nuvoton:/var/lib/systemd/coredump# ls\nroot@olympus-nuvoton:/var/lib/systemd/coredump#\n\nI will check \"Trigger Host Watchdog Error\" this keyword to get more detail about this action: \"xyz.openbmc_project.State.Watchdog.Action.PowerCycle\" of phosphor-watchdog package. I think that might be your system will create dump log when receiving this action. If you have any finding or clues, welcome to let me know.\n\nThanks.",
      "parentUuid": "c033856b_8751e002",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d3e2387_a634abb2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-13T06:07:50Z",
      "side": 1,
      "message": "Hi Rahul,\nI have checked phosphor-watchdog and phosphor-debug-collector then found\nwhy dump is not getting created on my system after injecting Host Watchdog Error.\n\nFirst, we found that our phosphor-watchdog will apply intel patch from their github.\nhttps://github.com/Intel-BMC/openbmc/tree/intel/meta-openbmc-mods/meta-common/recipes-phosphor/watchdog/phosphor-watchdog\n0001-Customize-phosphor-watchdog-for-Intel-platforms.patch\nDue to our system is intel x86 platform, thus we apply this match for customerizing our system.\n\nSecond, I have removed this patch and make phosphor-watchdog as original from openbmc github.\nThen run \"Verify_Dump_After_Host_Watchdog_Error_Injection\" test and result is PASS as yours.\nBTW, The test case is using original automation test without my changes.\n\nFrom the log, we found that seems the dump report be created in /var/lib/phosphor-debug-collector/dumps/1 folder.\nphosphor-dump-manager[840]: Thu Jan 13 03:36:44 UTC 2022 Report is available in /var/lib/phosphor-debug-collector/dumps/1\n\nBut, we didn\u0027t found any dump entry log 1 in /var/lib/phosphor-debug-collector/dumps/\nor /var/lib/systemd/coredump folder.\n\nThe dump list will show \"/xyz/openbmc_project/dump/bmc/entry/1\" data as below:\nhttps://10.103.152.249/xyz/openbmc_project/dump/bmc/entry/list\n{\n\"data\": [\n\"/xyz/openbmc_project/dump/bmc/entry/1\"\n],\n\"message\": \"200 OK\",\n\"status\": \"ok\"\n}\n\nBut, there is no any dump data in \"/xyz/openbmc_project/dump/bmc/entry/1\".\nThe content of \"data\" is empty.\nhttps://10.103.152.249/xyz/openbmc_project/dump/bmc/entry/1\n{\n\"data\": {},\n\"message\": \"200 OK\",\n\"status\": \"ok\"\n}\n\nThen I check the journal log and found that \"watchdog: Failed to start unit\" this line as below:\nphosphor-watchdog[2219]: watchdog: Failed to start unit\n\nFrom phosphor-watchdog/watchdog.cpp, we found that there is \"commit\u003cInternalFailure\u003e()\" be called\nthat cause phosphor-watchdog/elog_watch.cpp call create() to generate dump entry log path.\n\ncatch (const sdbusplus::exception::exception\u0026 e)\n{\n\tlog\u003clevel::ERR\u003e(\"watchdog: Failed to start unit\",\n\t\t\t\t\tentry(\"TARGET\u003d%s\", target-\u003esecond.c_str()),\n\t\t\t\t\tentry(\"ERROR\u003d%s\", e.what()));\n\tcommit\u003cInternalFailure\u003e();\n}\n\nI think that\u0027s why dump is getting created on your system after injecting Host Watchdog Error.\nBut the content of dump is empty seems not our expectation.\nWe should create a real dump to run this test.\nThe keyword \"Verify Dump After Host Watchdog Error Injection\" will not create a real bmc dump.\nThus, I think that the keyword \"Trigger Core Dump\" is good method to create a real dump.\n\nPlease help us to review this and provide some suggestions to make this test case more robust.\n\nBest regards,\nTim",
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6b4c2b8_6564cc41",
        "filename": "redfish/extended/test_bmc_dump.robot",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-01-03T07:36:27Z",
      "side": 1,
      "message": "Trigger core dump is not related to this keyword. So we should not add this here. I guess the reason you are hitting the issue is because no dump is created as part of \"Trigger Host Watchdog Error\". Please run host watchdog error command manually and see if dump is getting created.",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 41,
        "endChar": 18
      },
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c04477b_d3c197cf",
        "filename": "redfish/extended/test_bmc_dump.robot",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-01-03T08:19:14Z",
      "side": 1,
      "message": "\"Trigger Host Watchdog Error\" keyword just trigger host watchdog reset.\nThis keyword will not generate dump log.\n\nOnly \"Verify Core Dump Size\" this test case will use \"Trigger Core Dump\" to create dump log. And this \"Verify Dump After Host Watchdog Error Injection\" test case seems will according previous test case to check dump log.\n\nThat\u0027s why I remove this line \"Run Keyword And Ignore Error  Redfish Delete All BMC Dumps\" in previous patch.\n\nTrigger Host Watchdog Error\n    [Documentation]  Inject host watchdog timeout error via REST.\n    [Arguments]  ${milliseconds}\u003d1000  ${sleep_time}\u003d5s\n\n    # Description of argument(s):\n    # milliseconds  The time watchdog timer value in milliseconds (e.g. 1000 \u003d\n    #               1 second).\n    # sleep_time    Time delay for host watchdog error to get injected.\n    #               Default is 5 seconds.\n\n    ${data}\u003d  Create Dictionary\n    ...  data\u003dxyz.openbmc_project.State.Watchdog.Action.PowerCycle\n    ${status}  ${result}\u003d  Run Keyword And Ignore Error\n    ...  Read Attribute  ${HOST_WATCHDOG_URI}  ExpireAction\n    Run Keyword If  \u0027${status}\u0027 \u003d\u003d \u0027PASS\u0027\n    ...  Write Attribute  ${HOST_WATCHDOG_URI}  ExpireAction  data\u003d${data}",
      "parentUuid": "f6b4c2b8_6564cc41",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 41,
        "endChar": 18
      },
      "revId": "6dbdad4f207db5aaeb11d88701bed39c966dbcf2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}